<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDEX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="directionForm">
        <div style="padding-left: 15px;">
            <label for="direction">Direction:</label>
            <select id="direction"><option value=""></option></select>
            <label for="date">Date:</label>
            <select id="date"></select>
            <input type="submit" value="Search">
        </div>
        <hr>
    </form>
    <form id="vagonForm">
        <div class="seats">
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat1">
                    <label for="seat1">1</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat2">
                    <label for="seat2">2</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat3">
                    <label for="seat3">3</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat4">
                    <label for="seat4">4</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat5">
                    <label for="seat5">5</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat6">
                    <label for="seat6">6</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat7">
                    <label for="seat7">7</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat8">
                    <label for="seat8">8</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat9">
                    <label for="seat9">9</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat10">
                    <label for="seat10">10</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat11">
                    <label for="seat11">11</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat12">
                    <label for="seat12">12</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat13">
                    <label for="seat13">13</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat14">
                    <label for="seat14">14</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat15">
                    <label for="seat15">15</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat16">
                    <label for="seat16">16</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat17">
                    <label for="seat17">17</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat18">
                    <label for="seat18">18</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat19">
                    <label for="seat19">19</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat20">
                    <label for="seat20">20</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat21">
                    <label for="seat21">21</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat22">
                    <label for="seat22">22</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat23">
                    <label for="seat23">23</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat24">
                    <label for="seat24">24</label>
                </div>
            </div>
            <div class="room">
                <div class="seat">
                    <input type="checkbox" id="seat25">
                    <label for="seat25">25</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat26">
                    <label for="seat26">26</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat27">
                    <label for="seat27">27</label>
                </div>
                <div class="seat">
                    <input type="checkbox" id="seat28">
                    <label for="seat28">28</label>
                </div>
            </div>
            <!-- я лишком крутой чтобы делать функцией, только вручную через копи паст))) -->
        </div>
        <div class="cost">
            <p>Total price: <b id="totalPrice"></b><b>$</b></p>
            <input type="submit" value="Book">
        </div>
    </form>
    <div class="ticketBook">
        <h3>My tickets:</h3>
        <table id="ticketTable">
            <tr>
                <td>Direction</td>
                <td>Date</td>
                <td>Seat</td>
            </tr>
        </table>
    </div>
    <script>
        directions = [
            {
                name: "Odessa - Lviv",
                date: [
                    "24.07.2018"
                ],
                seats: Array(28).fill(false)
            }
        ]

        const directionForm = document.getElementById("directionForm");
        const directionSelect = document.getElementById("direction");
        const resultTable = document.getElementById("ticketTable");
        const dateSelect = document.getElementById("date");
        const vagonForm = document.getElementById("vagonForm");
        const totalPrice = document.getElementById("totalPrice");
        bookedTickets = [];
        const seats = Array.from(document.getElementsByTagName("input")).filter(seat => seat.type === "checkbox");
        seats.forEach((seat, seatIndex) => {
                seat.disabled = true;
            });

        directions.forEach((direction, directionIndex) => {
            const directionOption = document.createElement("option");
            directionOption.value = directionIndex;
            directionOption.textContent = direction.name;
            directionSelect.appendChild(directionOption);
        });

        directionSelect.addEventListener("change", () => {
            const selectedDirection = directions[directionSelect.value];
            dateSelect.innerHTML = "";
            selectedDirection.date.forEach((date, dateIndex) => {
                const dateOption = document.createElement("option");
                dateOption.value = dateIndex;
                dateOption.textContent = date;
                dateSelect.appendChild(dateOption);
            });
        });

        directionForm.addEventListener("submit", (event) => {
            event.preventDefault();
            seats.forEach((seat, seatIndex) => {
                seat.disabled = false;
            })
            seatsInfo = directions[directionSelect.value].seats;
            seats.forEach((seat, seatIndex) => {
                seat.checked = seatsInfo[seatIndex];
                if (seat.checked) {
                    seat.disabled = true;
                }
            });
            totalPrice.textContent = 0;
        });

        seats.forEach((seat, seatIndex) => {
            seat.addEventListener("change", () => {
                if (seat.checked) {
                    bookedTickets.push(seatIndex);
                }
                else {
                    bookedTickets = bookedTickets.filter(ticket => ticket !== seatIndex);
                }
                totalPrice.textContent = bookedTickets.length * 62;
            });
        });

        vagonForm.addEventListener("submit", (e) => {
            e.preventDefault();
            seats.forEach((seat, seatIndex) => {
                directions[directionSelect.value].seats[seatIndex] = seat.checked;
            });
            bookedTickets.forEach((seat) => {
                ticket = document.createElement("tr");
                ticket.innerHTML = `
                    <td>${directions[directionSelect.value].name}</td>
                    <td>${directions[directionSelect.value].date[dateSelect.value]}</td>
                    <td>${seat + 1}</td>
                `;
                resultTable.appendChild(ticket);
            })
            bookedTickets.forEach((seat) => {
                seats[seat].disabled = true;
            })
            bookedTickets = [];
            totalPrice.textContent = 0;

        });
    </script>
</body>
</html>
